<div class="auth-form-container">
  <ng-content select="[auth-header]"/>

  @if (authService.authState.isLoading()) {
    <omni-auth-ui-mat-loader [verticalCenter]="true"/>
  }

  @if (authService.authState.value(); as user) {
    @switch (user.state) {
      @case ('authenticated') {
        @if (config()?.hideAuthenticatedContent !== true) {
          <omni-auth-ui-mat-authenticated [content]="content()"/>
        }
        <ng-content select="[auth-user-is-authenticated]"/>
        @if (authRouteService.currentStep(); as currentStep) {
          @if (["change_password"].includes(currentStep)) {
            <omni-auth-ui-mat-authenticated-change-password [content]="content()"/>
          }
        }
      }

      @case ('error') {
        <omni-auth-ui-mat-message type="warn">
          {{ user.error?.getErrorMessage() ?? content().errors.unknown }}
        </omni-auth-ui-mat-message>

        <div class="message-footer">
          <omni-auth-ui-mat-button type="primary" (click)="authService.signOut()">Logout</omni-auth-ui-mat-button>
        </div>
      }
      @case ('unauthenticated') {
        @if (authRouteService.currentStep(); as currentStep) {
          @if (["login", "register"].includes(currentStep)) {
            <mat-tab-group
              selectedIndex="{{ currentStep === 'login' ? 0 : 1 }}"
            >
              <mat-tab [label]="content().signIn.title">
                <ng-template matTabContent>
                  <omni-auth-ui-mat-signin [config]="config()?.signIn" [content]="content()">
                    <ng-content sign-in-footer select="[sign-in-footer]"/>
                  </omni-auth-ui-mat-signin>
                </ng-template>
              </mat-tab>

              <mat-tab [label]="content().signUp.title">
                <omni-auth-ui-mat-signup [config]="config()?.signUp" [content]="content()">
                  <ng-content sign-up-footer select="[sign-up-footer]"/>
                </omni-auth-ui-mat-signup>
              </mat-tab>
            </mat-tab-group>
          }

          @if (currentStep === "confirm_sign_up") {
            <omni-auth-ui-mat-confirm-signup [content]="content()"/>
          }

          @if (currentStep === "confirm_sign_up_link") {
            <omni-auth-ui-mat-confirm-signup [content]="content()" [isLinkMode]="true"/>
          }

          @if (currentStep === "confirm_sign_in") {
            <omni-auth-ui-mat-confirm-signin [content]="content()"/>
          }

          @if (["reset_password", "confirm_reset_password", "reset_password_link"].includes(currentStep)) {
            <omni-auth-ui-mat-reset-password [content]="content()"  [isLinkMode]="currentStep === 'reset_password_link'"/>
          }
        }
      }
    }
  }
  <ng-content select="[auth-footer]"/>
</div>
